# Chronix Scheduler 

[English](./README.md) | [ç®€ä½“ä¸­æ–‡](./README.zh.md)

---

## ğŸ”§ é¡¹ç›®æ¦‚è§ˆ

è½»é‡çº§ã€é«˜æ€§èƒ½çš„ C++ å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼Œæ”¯æŒ Cron è¡¨è¾¾å¼è°ƒåº¦ã€ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–ã€é’©å­å›è°ƒã€çº¿ç¨‹æ± å¹¶å‘æ‰§è¡Œï¼Œé€‚ç”¨äºæœåŠ¡ç«¯å®šæ—¶ä»»åŠ¡è°ƒåº¦åœºæ™¯ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹è‰²

- â±ï¸ **Cron è¡¨è¾¾å¼è°ƒåº¦**ï¼šæ”¯æŒç§’çº§ç²¾åº¦
- ğŸ§µ **çº¿ç¨‹æ± å¹¶å‘æ‰§è¡Œ**ï¼šä»»åŠ¡å¹¶å‘è°ƒåº¦ï¼Œæ€§èƒ½å¼ºæ‚
- ğŸ§© **ä»»åŠ¡é’©å­æœºåˆ¶**ï¼šæ”¯æŒå¼€å§‹ã€æˆåŠŸã€ç»“æŸã€å¤±è´¥å›è°ƒ
- ğŸ”„ **ä»»åŠ¡æŒä¹…åŒ–**ï¼šä»»åŠ¡çŠ¶æ€å¯ä¿å­˜ä¸æ¢å¤
- â¯ï¸ **ä»»åŠ¡æ§åˆ¶**ï¼šæ”¯æŒæ·»åŠ ã€æš‚åœã€æ¢å¤ã€åˆ é™¤ä»»åŠ¡
- â³ **å»¶æ—¶ä¸€æ¬¡æ€§ä»»åŠ¡**ï¼šæ”¯æŒå»¶æ—¶æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œç§’çº§ç²¾åº¦
- ğŸ“Š **ä»»åŠ¡æŒ‡æ ‡ç»Ÿè®¡**ï¼šæ”¯æŒä»»åŠ¡æ‰§è¡Œæ¬¡æ•°ã€æˆåŠŸ/å¤±è´¥æ¬¡æ•°ã€è€—æ—¶ç­‰è¿è¡Œæ—¶æŒ‡æ ‡ï¼Œå¯å¯¹æ¥ Prometheus å®æ—¶ä¸ŠæŠ¥

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. åˆå§‹åŒ–è°ƒåº¦å™¨

```cpp
// åˆå§‹åŒ–æ—¶æŒ‡å®šçº¿ç¨‹æ± å¤§å°ï¼ˆä¾‹å¦‚ 4 ä¸ªå·¥ä½œçº¿ç¨‹ï¼‰
auto scheduler = std::make_shared<ChronixScheduler>(4);
```

### 2. æ·»åŠ å®šæ—¶ä»»åŠ¡

```cpp
// æ¯ 10 ç§’æ‰§è¡Œä¸€æ¬¡
int job_id = scheduler.add_cron_job("*/10 * * * * *", []() { std::cout << "ä»»åŠ¡æ‰§è¡Œ" << std::endl; });

scheduler->set_start_callback(job_id, [](int id) { std::cout << "ä»»åŠ¡ " << id << " å¼€å§‹æ‰§è¡Œ" << std::endl; });
scheduler->set_success_callback(job_id, [](int id) { std::cout << "ä»»åŠ¡ " << id << " æ‰§è¡ŒæˆåŠŸ" << std::endl; });
scheduler->set_error_callback(job_id, [](int id, std::exception& e) { std::cerr << "ä»»åŠ¡ " << id << " æ‰§è¡Œå¤±è´¥: " << e.what() << std::endl; });
// è¿™é‡Œå¯é€‰æ‹©æŒä¹…åŒ–ä»»åŠ¡çŠ¶æ€
scheduler->set_end_callback(job_id, [](int id) { std::cout << "ä»»åŠ¡" << id << " æ‰§è¡Œç»“æŸ" << std::endl; });
```

### 3. æ·»åŠ å»¶æ—¶ä»»åŠ¡

```cpp
// å»¶æ—¶ä¸‰ç§’åæ‰§è¡Œä¸€æ¬¡
scheduler->add_one_time_job(std::chrono::system_clock::now() + std::chrono::seconds(3), []() { printer("[ä»»åŠ¡2]å»¶æ—¶3ç§’æ‰§è¡Œ"); });
```

### 4. æ§åˆ¶ä»»åŠ¡çŠ¶æ€

```cpp
scheduler.pause_job(job_id);
scheduler.resume_job(job_id);
scheduler.remove_job(job_id);
```

### 5. ä»»åŠ¡æŒä¹…åŒ–

```cpp
scheduler->set_persistence(std::make_shared<DBPersistenceMySQL<Job>>("127.0.0.1", 33036, "root", "******", "chronix"));
scheduler.save_state();     // ä¿å­˜ä»»åŠ¡
scheduler.load_state();     // æ¢å¤ä»»åŠ¡

// æ¢å¤æ—¶éœ€é‡æ–°æ³¨å†Œä»»åŠ¡è¡Œä¸º
scheduler.register_job_initializer(job_id, [](Job& job) {
    job.task = []() { std::cout << "ä»»åŠ¡é‡æ–°ç»‘å®šæ‰§è¡Œä½“" << std::endl; };
});
```

### 6. å¯åŠ¨è°ƒåº¦å™¨

```cpp
scheduler.start();
```
æ›´è¯¦ç»†çš„ä½¿ç”¨æ¡ˆä¾‹å¯æŸ¥çœ‹ example/example.cpp æ–‡ä»¶ã€‚

---

## ğŸ“Š æ€§èƒ½å‹æµ‹æŠ¥å‘Š

### ğŸ§ª æ€§èƒ½å‹æµ‹é…ç½®

| **é…ç½®é¡¹**         | **å‚æ•°**                            |
| -------------- | ------------------------------- |
| CPU çº¿ç¨‹æ•°     | `std::thread::hardware_concurrency() * 4` |
| å•è½®ä»»åŠ¡æ•°     | 5000                            |
| æ€»è½®æ•°         | 10                              |
| æ€»ä»»åŠ¡æ•°       | 50,000                           |
| æ¯è½®è¿è¡Œæ—¶é—´   | 30 ç§’                           |
| è°ƒåº¦é¢‘ç‡       | æ¯ 1 ~ 5 ç§’ï¼ˆcron è¡¨è¾¾å¼ `*/N * * * * *`ï¼‰ |
| ä»»åŠ¡ä½“         | éšæœºè€—æ—¶ 1 ~ 10 æ¯«ç§’ï¼Œ10%æ¦‚ç‡å¤±è´¥           |

### ğŸ“ˆ è¿è¡Œç»“æœæ±‡æ€»

| è½®æ¬¡ç¼–å· | æ€»æ‰§è¡Œæ¬¡æ•° | æˆåŠŸæ¬¡æ•° | å¤±è´¥æ¬¡æ•° | å¹³å‡è€—æ—¶(ms) | æœ€å¤§è€—æ—¶(ms) | æœ€å°è€—æ—¶(ms) | æ€»è€—æ—¶(s) | ååé‡(tps)         | æˆåŠŸç‡             | é”™è¯¯ç‡              |
|----------|------------|----------|----------|---------------|---------------|---------------|------------|----------------------|---------------------|----------------------|
| 1        | 59039      | 53037    | 6002     | 5.411         | 23            | 1             | 346.237    | 170.5161493427912    | 89.8338386490286    | 10.166161350971393   |
| 2        | 28845      | 25894    | 2951     | 5.4366        | 17            | 1             | 168.659    | 171.02556045037622   | 89.76945744496446   | 10.230542555035536   |
| 3        | 17597      | 15843    | 1754     | 5.5           | 16            | 1             | 103.127    | 170.63426648695295   | 90.03239188498038   | 9.967608115019605    |
| 4        | 12463      | 11189    | 1274     | 5.5408        | 16            | 1             | 72.697     | 171.43761090553943   | 89.77774211666532   | 10.22225788333467    |
| 5        | 10000      | 8976     | 1024     | 5.584         | 17            | 1             | 58.284     | 171.57367373550204   | 89.76               | 10.24                |
| 6        | 8806       | 7930     | 876      | 5.7072        | 15            | 1             | 51.91      | 169.63976112502408   | 90.05223711106063   | 9.94776288893936     |
| 7        | 5000       | 4477     | 523      | 5.7642        | 14            | 1             | 28.821     | 173.48461191492316   | 89.54               | 10.46                |
| 8        | 5000       | 4495     | 505      | 5.9122        | 19            | 1             | 29.561     | 169.14177463549947   | 89.9                | 10.100000000000001   |
| 9        | 5000       | 4498     | 502      | 5.852         | 16            | 1             | 29.26      | 170.88174982911826   | 89.96               | 10.040000000000001   |
| 10       | 5000       | 4481     | 519      | 5.8808        | 17            | 1             | 29.404     | 170.04489185144877   | 89.62               | 10.38                |

---

## ğŸ“„ è®¸å¯åè®®

æœ¬é¡¹ç›®åŸºäº MIT License å¼€æºä½¿ç”¨ã€‚
